{% extends 'admin/master.html' %}
{% import 'shelf/base/lib.html' as lib with context %}
{% import 'shelf/model/layout.html' as model_layout with context %}

{% macro extra() %}
  <input name="_add_another" type="submit" class="btn btn-large" value="{{ _gettext('Save and Add') }}" />
{% endmacro %}

{% block iscontent %}active{% endblock %}

{% block head_css %}
    {{ super() }}
    <link href="{{ url_for('admin.static', filename='select2/select2.css') }}" rel="stylesheet">
    <link href="{{ url_for('admin.static', filename='datetimepicker/bootstrap-datetimepicker.css') }}" rel="stylesheet">
    <link href="{{ url_for('shelf.static', filename='shelf/css/bootstrap3-wysihtml5.min.css') }}"  rel="stylesheet" />
{% endblock %}

{% block body %}
    <div class="row" style="margin-top: 50px; background-color: #ffffff">
        <div class="col-xs-12" style="border-bottom: 1px solid #ddd; padding-top: 5px; padding-bottom: 15px; padding-left: 25px">
            {% block model_create_title %}<h1>{{ admin_view.name.upper() }}</h1>{% endblock %}
        </div>
        <div class="col-xs-12"  style="padding-top: 25px; padding-bottom: 15px">
          {% call lib.form_tag(form) %}
              {{ lib.render_form_fields(form) }}
          {% endcall %}
        </div>
    </div>
{% endblock %}

{% block tail_js %}
  {{ lib.navbar(model_layout.create_left_bottom_bar, model_layout.create_right_bottom_bar, admin_view.name, pos="bottom") }}
  {{ super() }}
  <script src="{{ url_for('admin.static', filename='datetimepicker/bootstrap-datetimepicker.js') }}"></script>
  <script src={{ url_for('shelf.static', filename='tinymce/tinymce.min.js') }}></script>
  <script src="{{ url_for('shelf.static', filename='shelf/js/wysihtml5-0.3.0.min.js') }}"></script>
  <script src="{{ url_for('shelf.static', filename='shelf/js/bootstrap3-wysihtml5.all.min.js') }}"></script>
  <script src="{{ url_for('shelf.static', filename='shelf/js/bootstrap3-wysihtml5.min.js') }}"></script>
  <script src="{{ url_for('shelf.static', filename='shelf/js/form.js') }}"></script>
  <script language="javascript">
        (function($) {
            $('a.save-model').click(function (e) {
                $("form.model-form").submit();
                e.stopPropagation();
            });

            $('a.add-new').click(function (e) {
                $('input[name=_continue_editing]').val('1');
                $("form.model-form").submit();
                e.stopPropagation();
            });

            $('button.modal-open').on('click', function() {
              $(this).closest('.widget').find('.modal').modal({
                remote: "/admin/library/modal/",
                toggle: "modal"
              });
              return false;
            });

            $('ul.dropdown-menu li.actions.draft > a').click(function (e) {
              $('li.actions.dropdown > a.dropdown-toggle > span').html($(this).html());
              $('li.actions.dropdown').removeClass("review publish").addClass("draft");
              $('ul.dropdown-menu li.actions.review').show();
              $('ul.dropdown-menu li.actions.publish').show();
              $('ul.dropdown-menu li.actions.draft').hide();
              $('#shelf_state').val("draft");
            });

            $('ul.dropdown-menu li.actions.review > a').click(function (e) {
              $('li.actions.dropdown > a.dropdown-toggle > span').html($(this).html());
              $('li.actions.dropdown').removeClass("draft publish").addClass("review");
              $('ul.dropdown-menu li.actions.draft').show();
              $('ul.dropdown-menu li.actions.publish').show();
              $('ul.dropdown-menu li.actions.review').hide();
              $('#shelf_state').val("private");
            });

            $('ul.dropdown-menu li.actions.publish > a').click(function (e) {
              $('li.actions.dropdown > a.dropdown-toggle > span').html($(this).html());
              $('li.actions.dropdown').removeClass("draft review").addClass("publish");
              $('ul.dropdown-menu li.actions.draft').show();
              $('ul.dropdown-menu li.actions.review').show();
              $('ul.dropdown-menu li.actions.publish').hide();
              $('#shelf_state').val("public");
            });

       tinymce.init({
           selector: ".wysiwyg-full",
           plugins: "autoresize,paste,image,link,code,searchreplace,table,media",
         });

            $('.wysiwyg').wysihtml5({
                html: true,
            });
        })(jQuery);
    </script>
{% endblock %}
